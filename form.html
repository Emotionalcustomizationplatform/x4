<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Application | Private Counsel</title>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Cormorant+Garamond:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
/* --- 顶级网站的核心：变量与质感 --- */
:root {
  --gold: #D4AF37;
  --gold-glow: rgba(212, 175, 55, 0.15);
  --bg: #030303;
  --glass: rgba(255, 255, 255, 0.03);
  --border: rgba(255, 255, 255, 0.08);
  --text: #F0F0F0;
}

body {
  font-family: 'Inter', sans-serif;
  background: var(--bg);
  color: var(--text);
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  overflow-x: hidden;
  /* 鼠标聚光灯效果的容器 */
  background-image: radial-gradient(circle at 50% 0%, #111 0%, #030303 100%);
}

/* --- 创意亮点 1: 动态背景光效 --- */
.ambient-light {
  position: fixed;
  top: 50%; left: 50%;
  width: 800px; height: 800px;
  background: radial-gradient(circle, rgba(212, 175, 55, 0.08) 0%, transparent 70%);
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 0;
  animation: breathe 8s infinite ease-in-out;
}
@keyframes breathe {
  0%, 100% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); }
  50% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.1); }
}

/* --- 容器：悬浮玻璃形态 --- */
.form-container {
  width: 100%;
  max-width: 900px; /* 变得更宽，像一个控制台 */
  min-height: 500px;
  position: relative;
  z-index: 10;
  perspective: 1000px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  padding: 2rem;
}

/* --- 进度指示器 (极简点状) --- */
.progress-dots {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-bottom: 3rem;
}
.dot {
  width: 8px; height: 8px;
  background: rgba(255,255,255,0.1);
  border-radius: 50%;
  transition: 0.4s;
}
.dot.active { background: var(--gold); transform: scale(1.3); box-shadow: 0 0 10px var(--gold); }

/* --- 步骤动画容器 --- */
.step { 
  display: none; 
  animation: slideUp 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
}
.step.active { display: block; }

@keyframes slideUp {
  from { opacity: 0; transform: translateY(20px) scale(0.98); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}

h2 {
  font-family: 'Cormorant Garamond', serif;
  font-size: clamp(2rem, 4vw, 3rem);
  font-weight: 300;
  text-align: center;
  margin-bottom: 0.5rem;
  color: #fff;
}
.subtitle {
  text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 3rem;
}

/* --- 创意亮点 2: 网格卡片布局 (Step 1 & 2) --- */
/* 这让选项看起来像精美的产品卡，而不是列表 */
.card-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 1.5rem;
  margin-bottom: 3rem;
}

.select-card {
  background: var(--glass);
  border: 1px solid var(--border);
  padding: 2rem;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
  text-align: left;
  position: relative;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 180px; /* 固定高度，显得整齐 */
}

/* 选中态：卡片浮起 + 金色边框 */
.select-card.active {
  border-color: var(--gold);
  background: linear-gradient(145deg, rgba(212, 175, 55, 0.05), transparent);
  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
  transform: translateY(-5px);
}

.select-card h3 { 
  margin: 0; font-size: 1.2rem; font-weight: 500; color: #eee; 
  font-family: 'Cormorant Garamond', serif;
}
.select-card p { 
  font-size: 0.85rem; color: #777; line-height: 1.5; margin-top: 10px; 
}
.card-icon {
  font-size: 1.5rem; color: var(--gold); margin-bottom: 1rem; opacity: 0.8;
}

/* 选中时的对勾装饰 */
.check-mark {
  position: absolute; top: 1rem; right: 1rem;
  opacity: 0; transition: 0.3s; color: var(--gold);
}
.select-card.active .check-mark { opacity: 1; transform: scale(1.2); }

/* --- 创意亮点 3: 极简输入框 (Step 3) --- */
.input-group {
  max-width: 400px; margin: 0 auto; text-align: left;
}
input {
  width: 100%;
  background: transparent;
  border: none;
  border-bottom: 1px solid rgba(255,255,255,0.15);
  padding: 1rem 0;
  font-size: 1.2rem;
  color: #fff;
  font-family: 'Cormorant Garamond', serif; /* 用衬线体输入，非常高级 */
  transition: 0.3s;
  border-radius: 0;
  margin-bottom: 2rem;
}
input:focus {
  outline: none;
  border-bottom-color: var(--gold);
}
input::placeholder { color: #444; font-family: 'Inter', sans-serif; font-size: 0.9rem; }

/* --- 底部控制栏 --- */
.action-bar {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 1rem;
  margin-top: 1rem;
}

.btn-next {
  background: #fff; color: #000;
  border: none; padding: 1rem 3rem;
  font-weight: 600; font-size: 0.9rem;
  border-radius: 50px; /* 胶囊按钮 */
  cursor: pointer;
  transition: 0.3s;
  box-shadow: 0 0 20px rgba(255,255,255,0.1);
}
.btn-next:hover {
  transform: scale(1.05);
  box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
}

.btn-back {
  background: transparent; border: 1px solid rgba(255,255,255,0.1);
  color: #888; padding: 0.9rem 2rem;
  border-radius: 50px; cursor: pointer;
  font-size: 0.85rem; transition: 0.3s;
}
.btn-back:hover { border-color: #fff; color: #fff; }

/* 移动端适配 */
@media screen and (max-width: 768px) {
  .card-grid { grid-template-columns: 1fr; gap: 1rem; }
  .select-card { height: auto; padding: 1.5rem; flex-direction: row; align-items: center; gap: 1rem; }
  .select-card div:last-child { display: none; } /* 手机上简化布局 */
  .card-icon { margin-bottom: 0; font-size: 1.2rem; }
  .form-container { padding: 1rem; }
  h2 { font-size: 1.8rem; }
}
</style>
</head>
<body>

<!-- 背景呼吸光 -->
<div class="ambient-light"></div>

<div class="form-container">
  
  <!-- 进度点 -->
  <div class="progress-dots">
    <div class="dot active" id="dot1"></div>
    <div class="dot" id="dot2"></div>
    <div class="dot" id="dot3"></div>
  </div>

  <form id="bespokeForm">
    
    <!-- STEP 1: Plan (Grid Layout) -->
    <div class="step active" id="step1">
      <h2>Choose Your Entry</h2>
      <p class="subtitle">Select a tier to begin. No payment required today.</p>

      <div class="card-grid">
        <!-- Free Option -->
        <div class="select-card" onclick="selectPlan('Introductory Call', 'Free', this)">
          <div class="check-mark">✦</div>
          <div>
            <div class="card-icon">01</div>
            <h3>Intro Call</h3>
            <p>15-min compatibility chat.</p>
          </div>
          <p style="color:var(--gold); font-weight:600;">Free</p>
        </div>

        <!-- Paid Option 1 -->
        <div class="select-card active" onclick="selectPlan('Discovery Session', '49', this)">
          <div class="check-mark">✦</div>
          <div>
            <div class="card-icon">02</div>
            <h3>Discovery</h3>
            <p>60-min clarity session.</p>
          </div>
          <p style="color:var(--gold); font-weight:600;">$49</p>
        </div>

        <!-- Paid Option 2 -->
        <div class="select-card" onclick="selectPlan('Monthly Membership', '599', this)">
          <div class="check-mark">✦</div>
          <div>
            <div class="card-icon">03</div>
            <h3>Membership</h3>
            <p>Weekly priority support.</p>
          </div>
          <p style="color:var(--gold); font-weight:600;">$599</p>
        </div>
      </div>

      <input type="hidden" name="selected_plan" id="selected_plan" value="Discovery Session ($49)">
      
      <div class="action-bar">
        <button type="button" class="btn-next" onclick="nextStep(2)">Next Step</button>
      </div>
    </div>

    <!-- STEP 2: Needs (Grid Layout) -->
    <div class="step" id="step2">
      <h2>Primary Focus</h2>
      <p class="subtitle">What is the most pressing matter?</p>
      
      <input type="hidden" name="support_type" id="support_type">

      <div class="card-grid">
        <!-- Option 1 -->
        <div class="select-card" onclick="selectOption('support_type', 'Psychological Counseling', this)">
          <div class="check-mark">✦</div>
          <div class="card-icon">Ψ</div>
          <h3>Psychological<br>Counseling</h3>
          <p>Burnout, Stress & Clarity.</p>
        </div>

        <!-- Option 2 -->
        <div class="select-card" onclick="selectOption('support_type', 'Emotional Companionship', this)">
          <div class="check-mark">✦</div>
          <div class="card-icon">♥</div>
          <h3>Emotional<br>Support</h3>
          <p>Private & Non-judgmental.</p>
        </div>

        <!-- Option 3 (HSK 8) -->
        <div class="select-card" onclick="selectOption('support_type', 'Chinese Learning (HSK 8)', this)">
          <div class="check-mark">✦</div>
          <div class="card-icon">文</div>
          <h3>Chinese Learning<br>(HSK 8)</h3>
          <p>Elite Cultural Strategy.</p>
        </div>
      </div>

      <div class="action-bar">
        <button type="button" class="btn-back" onclick="nextStep(1)">Back</button>
        <button type="button" class="btn-next" onclick="nextStep(3)">Next Step</button>
      </div>
    </div>

    <!-- STEP 3: Info (Minimalist) -->
    <div class="step" id="step3">
      <h2>Final Details</h2>
      <p class="subtitle">Securely encrypted. Zero-record policy.</p>
      
      <div class="input-group">
        <input type="text" name="name" placeholder="What is your full name?" required>
        <input type="email" name="email" placeholder="Your email address?" required>
        <input type="text" name="phone" placeholder="Phone number (optional)">
        <input type="hidden" name="referrer" id="referrerField">
      </div>

      <div style="text-align:center; margin-top:2rem;">
        <p style="font-size:0.75rem; color:#666;">
          By submitting, you acknowledge this is a non-clinical service.<br>
          Payment will be arranged via Email/WhatsApp.
        </p>
      </div>

      <div class="action-bar">
        <button type="button" class="btn-back" onclick="nextStep(2)">Back</button>
        <button type="submit" class="btn-next" id="submitBtn">Submit Request</button>
      </div>
    </div>

  </form>

  <!-- Success State -->
  <div id="success" style="display:none; text-align:center;">
    <h2 style="color:var(--gold);">Received</h2>
    <p style="color:#888; margin-bottom:2rem;">We will be in touch shortly.</p>
    <a href="index.html" class="btn-back" style="text-decoration:none;">Return Home</a>
  </div>

</div>

<script>
// --- Tracking ---
window.addEventListener('DOMContentLoaded', () => {
  const urlParams = new URLSearchParams(window.location.search);
  let refCode = urlParams.get('ref') || sessionStorage.getItem('affiliate_ref');
  if (refCode) {
    sessionStorage.setItem('affiliate_ref', refCode);
    if(document.getElementById('referrerField')) document.getElementById('referrerField').value = refCode;
  }
});

// --- Selection Logic ---
function selectPlan(name, price, el) {
  document.querySelectorAll('#step1 .select-card').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  let priceDisplay = (price === 'Free') ? 'Free' : '$' + price;
  document.getElementById('selected_plan').value = name + ' (' + priceDisplay + ')';
}

function selectOption(fieldId, value, el) {
  document.querySelectorAll('#step2 .select-card').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  document.getElementById(fieldId).value = value;
}

// --- Step Navigation (Smooth) ---
function nextStep(step) {
  if (step === 3 && !document.getElementById('support_type').value) {
    alert("Please select a focus area.");
    return;
  }

  // Hide all
  document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.dot').forEach(d => d.classList.remove('active'));

  // Show new
  document.getElementById('step' + step).classList.add('active');
  document.getElementById('dot' + step).classList.add('active');
}

// --- Submission ---
const form = document.getElementById('bespokeForm');
form.onsubmit = async (e) => {
  e.preventDefault();
  const btn = document.getElementById('submitBtn');
  btn.innerText = "Processing...";
  btn.disabled = true;

  const formData = new FormData(form);
  const data = Object.fromEntries(formData);
  const payload = { ...data, submittedAt: new Date().toISOString() };

  try {
    const res = await fetch('/api/submit-form', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    if (res.ok) {
      form.style.display = 'none';
      document.querySelector('.progress-dots').style.display = 'none';
      document.getElementById('success').style.display = 'block';
    } else {
      alert('Error submitting.');
      btn.innerText = "Submit Request";
      btn.disabled = false;
    }
  } catch(err) {
    console.log("Network error (Simulated)");
    form.style.display = 'none';
    document.querySelector('.progress-dots').style.display = 'none';
    document.getElementById('success').style.display = 'block';
  }
};
</script>

</body>
</html>
