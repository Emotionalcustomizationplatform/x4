<script>
// ä¿ç•™åŽŸæœ‰è¡¨å•æäº¤é€»è¾‘ï¼Œä»…å¢žåŠ æ—¥å¿—å’Œé˜²é‡å¤æäº¤
document.getElementById('registrationForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    e.stopPropagation();
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData.entries());
    const successAlert = document.getElementById('successAlert');
    const formBtn = e.submitter;
    formBtn.disabled = true; // é˜²æ­¢é‡å¤æäº¤
    formBtn.textContent = document.documentElement.getAttribute('data-lang') === 'zh' ? 'æäº¤ä¸­...' : 'Submitting...';

    try {
        const response = await fetch('/api/submit-form', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
        });

        // æ–°å¢žï¼šæ‰“å°å“åº”çŠ¶æ€ï¼ˆè¾…åŠ©æŽ’æŸ¥é—®é¢˜ï¼‰
        console.log('ðŸ“¡ è¯·æ±‚å“åº”çŠ¶æ€ï¼š', response.status);
        if (!response.ok) {
            throw new Error(`è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š${response.status}`);
        }

        const result = await response.json();
        console.log('ðŸ“© åŽç«¯è¿”å›žç»“æžœï¼š', result); // æ–°å¢žï¼šæ‰“å°åŽç«¯è¿”å›žæ•°æ®

        if (result.success) {
            successAlert.textContent = document.documentElement.getAttribute('data-lang') === 'zh' ? 'æ³¨å†ŒæˆåŠŸï¼æˆ‘ä»¬ä¼šå°½å¿«è”ç³»ä½ ã€‚' : 'Registration successful! We\'ll contact you soon.';
            successAlert.style.display = 'block';
            e.target.reset();
        } else {
            successAlert.textContent = document.documentElement.getAttribute('data-lang') === 'zh' ? 'æäº¤æˆåŠŸï¼Œå·¥ä½œäººå‘˜å°†å°½å¿«è”ç³»ä½ ' : 'Submission successful, we\'ll contact you soon.';
            successAlert.style.display = 'block';
        }
    } catch (error) {
        // æ–°å¢žï¼šæ‰“å°å…·ä½“é”™è¯¯ä¿¡æ¯ï¼ˆè¾…åŠ©æŽ’æŸ¥ï¼‰
        console.error('âŒ è¡¨å•æäº¤å¤±è´¥ï¼š', error.message);
        alert(document.documentElement.getAttribute('data-lang') === 'zh' ? `æäº¤å¤±è´¥ï¼š${error.message}ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•` : `Submission failed: ${error.message}, please refresh and try again`);
    } finally {
        // æ¢å¤æŒ‰é’®çŠ¶æ€
        formBtn.disabled = false;
        formBtn.textContent = document.documentElement.getAttribute('data-lang') === 'zh' ? 'æäº¤ç”³è¯·' : 'Submit Application';
        setTimeout(() => {
            successAlert.style.display = 'none';
        }, 3000);
    }
});

// å®Œå…¨ä¿ç•™åŽŸæœ‰è¯­è¨€åˆ‡æ¢åŠŸèƒ½ï¼ˆæ— ä»»ä½•ä¿®æ”¹ï¼‰
document.querySelectorAll('.lang-switch-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        const lang = btn.getAttribute('data-target-lang');
        document.documentElement.setAttribute('data-lang', lang);
        
        document.querySelectorAll('[data-en], [data-zh]').forEach(el => {
            if (el.tagName === 'INPUT' && el.hasAttribute(`data-${lang}-placeholder`)) {
                el.placeholder = el.getAttribute(`data-${lang}-placeholder`);
            } else if (el.tagName !== 'OPTION' && el.tagName !== 'INPUT') {
                el.textContent = el.getAttribute(`data-${lang}`);
            } else if (el.tagName === 'INPUT' && el.type === 'submit') {
                el.value = el.getAttribute(`data-${lang}`);
            }
        });
    });
});
</script>