<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Application | Private Counsel</title>

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

<style>
:root {
  --gold: #D4AF37;
  --bg: #050505;
  --text: #EAEAEA;
  --border: rgba(255, 255, 255, 0.1);
  --glass: rgba(20, 20, 20, 0.6);
}

body {
  margin: 0; padding: 0;
  font-family: 'Manrope', sans-serif;
  background: var(--bg); color: var(--text);
  height: 100vh; overflow: hidden; /* 锁住滚动，做成应用感 */
  display: flex;
}

/* --- 1. 左侧视觉区 (Desktop Only) --- */
.visual-side {
  flex: 1; position: relative; height: 100%;
  background-image: url('https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=2000&auto=format&fit=crop');
  background-size: cover; background-position: center;
  display: flex; flex-direction: column; justify-content: space-between; padding: 4rem;
}
/* 遮罩层，让字看清 */
.visual-side::before {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(to right, rgba(0,0,0,0.3), #050505);
}
.visual-content { position: relative; z-index: 2; }
.quote { 
  font-family: 'Playfair Display', serif; font-size: 2.5rem; line-height: 1.2; 
  color: #fff; max-width: 400px;
}
.quote span { color: var(--gold); font-style: italic; }

/* --- 2. 右侧交互区 --- */
.form-side {
  width: 600px; height: 100%;
  background: #050505;
  display: flex; flex-direction: column;
  position: relative;
  border-left: 1px solid var(--border);
}

/* 顶部导航 */
.form-header {
  padding: 2rem 3rem;
  display: flex; justify-content: space-between; align-items: center;
  border-bottom: 1px solid var(--border);
}
.back-link { font-size: 0.8rem; color: #666; text-decoration: none; transition: 0.3s; }
.back-link:hover { color: #fff; }

/* 进度条 (流动的金线) */
.progress-container {
  width: 100%; height: 2px; background: #111;
}
.progress-bar {
  height: 100%; background: var(--gold); width: 33%;
  transition: width 0.5s cubic-bezier(0.22, 1, 0.36, 1);
  box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
}

/* 表单容器 */
.form-content {
  flex: 1; padding: 3rem;
  overflow-y: auto; /* 内容多时可滚动 */
  display: flex; flex-direction: column; justify-content: center;
}

/* 标题 */
h2 { 
  font-family: 'Playfair Display', serif; font-size: 2.5rem; margin-bottom: 0.5rem; color: #fff; font-weight: 400; 
}
.subtitle { color: #666; margin-bottom: 3rem; font-size: 0.9rem; }

/* --- 步骤切换动画 --- */
.step { display: none; opacity: 0; transform: translateY(10px); transition: 0.4s ease; }
.step.active { display: block; opacity: 1; transform: translateY(0); }

/* --- Step 1: 价格卡片 (极简) --- */
.plan-card {
  display: flex; justify-content: space-between; align-items: center;
  padding: 1.5rem; border: 1px solid var(--border);
  margin-bottom: 1rem; cursor: pointer; transition: 0.3s;
  background: rgba(255,255,255,0.02);
}
.plan-card:hover { border-color: rgba(255,255,255,0.3); transform: translateX(5px); }
.plan-card.active { border-color: var(--gold); background: rgba(212, 175, 55, 0.05); }
.plan-name { font-size: 1.1rem; color: #fff; font-family: 'Playfair Display', serif; }
.plan-price { font-weight: 600; color: var(--gold); }

/* --- Step 2: 扑克牌式选项 (重点创意) --- */
.option-grid { display: grid; gap: 1rem; }
.option-card {
  position: relative;
  background: linear-gradient(145deg, #0f0f0f, #050505);
  border: 1px solid var(--border);
  padding: 1.5rem; cursor: pointer;
  transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
  overflow: hidden;
}
.option-card:hover { 
  border-color: rgba(212, 175, 55, 0.4); 
  transform: translateY(-3px);
  box-shadow: 0 10px 20px rgba(0,0,0,0.5);
}
.option-card.active {
  border-color: var(--gold);
  background: linear-gradient(145deg, rgba(212, 175, 55, 0.1), #050505);
}
/* 选中时的光圈动画 */
.option-card.active::before {
  content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%;
  background: var(--gold);
}
.opt-title { font-family: 'Playfair Display', serif; font-size: 1.3rem; color: #fff; margin-bottom: 0.5rem; }
.opt-desc { font-size: 0.8rem; color: #888; }

/* --- Step 3: 极简输入 (横线风格) --- */
input {
  width: 100%; background: transparent; border: none;
  border-bottom: 1px solid var(--border);
  color: #fff; padding: 1rem 0; font-size: 1.1rem;
  font-family: 'Manrope', sans-serif; margin-bottom: 2rem;
  transition: 0.3s; border-radius: 0;
}
input:focus { outline: none; border-bottom-color: var(--gold); }
input::placeholder { color: #444; }

/* --- 底部操作栏 --- */
.form-footer {
  padding: 2rem 3rem;
  border-top: 1px solid var(--border);
  display: flex; justify-content: space-between; align-items: center;
  background: #050505;
}
.btn-next {
  background: var(--gold); color: #000; border: none;
  padding: 1rem 2.5rem; font-weight: 600; cursor: pointer;
  transition: 0.3s; font-family: 'Manrope', sans-serif;
  letter-spacing: 1px; text-transform: uppercase; font-size: 0.8rem;
}
.btn-next:hover { background: #fff; }
.btn-back {
  background: transparent; border: 1px solid #333; color: #fff;
  padding: 0.8rem 2rem; cursor: pointer; transition: 0.3s;
  text-transform: uppercase; font-size: 0.7rem; letter-spacing: 1px;
}
.btn-back:hover { border-color: #fff; }

/* --- 移动端适配 --- */
@media (max-width: 900px) {
  .visual-side { display: none; } /* 手机上隐藏左侧图 */
  .form-side { width: 100%; border: none; }
  .form-content { padding: 2rem; }
  .form-header, .form-footer { padding: 1.5rem 2rem; }
  h2 { font-size: 2rem; }
}
</style>
</head>
<body>

<!-- 左侧视觉 (Desktop) -->
<div class="visual-side">
  <div class="visual-content">
    <div style="font-size:0.9rem; letter-spacing:2px; margin-bottom:2rem; opacity:0.7;">PRIVATE COUNSEL</div>
    <div class="quote">
      "True clarity comes from<br><span>strategic silence</span>."
    </div>
  </div>
</div>

<!-- 右侧表单 -->
<div class="form-side">
  
  <!-- 顶部 -->
  <div class="form-header">
    <a href="index.html" class="back-link">← Cancel</a>
    <div style="color:#444; font-size:0.8rem;">SECURE APPLICATION</div>
  </div>
  
  <!-- 进度条 -->
  <div class="progress-container"><div class="progress-bar" id="progress"></div></div>

  <!-- 内容区 -->
  <div class="form-content">
    <form id="bespokeForm">
      
      <!-- STEP 1 -->
      <div class="step active" id="step1">
        <h2>Select Tier</h2>
        <p class="subtitle">No payment required today.</p>

        <div class="plan-card" onclick="selectPlan('Introductory Call', 'Free', this)">
          <div>
            <div class="plan-name">Introductory Call</div>
            <div style="font-size:0.8rem; color:#666;">15-min chemistry check</div>
          </div>
          <div class="plan-price">Free</div>
        </div>

        <div class="plan-card active" onclick="selectPlan('Discovery Session', '49', this)">
          <div>
            <div class="plan-name">Discovery Session</div>
            <div style="font-size:0.8rem; color:#666;">One-time 60min clarity</div>
          </div>
          <div class="plan-price">$49</div>
        </div>

        <div class="plan-card" onclick="selectPlan('Monthly Membership', '599', this)">
          <div>
            <div class="plan-name">Membership</div>
            <div style="font-size:0.8rem; color:#666;">Weekly priority support</div>
          </div>
          <div class="plan-price">$599</div>
        </div>
        
        <input type="hidden" name="selected_plan" id="selected_plan" value="Discovery Session ($49)">
      </div>

      <!-- STEP 2 -->
      <div class="step" id="step2">
        <h2>Primary Focus</h2>
        <p class="subtitle">What is your priority?</p>
        <input type="hidden" name="support_type" id="support_type">

        <div class="option-grid">
          <div class="option-card" onclick="selectOption('support_type', 'Psychological Counseling', this)">
            <div class="opt-title">Psychological Counseling</div>
            <div class="opt-desc">Burnout, High-pressure stress & Clarity.</div>
          </div>

          <div class="option-card" onclick="selectOption('support_type', 'Emotional Companionship', this)">
            <div class="opt-title">Emotional Support</div>
            <div class="opt-desc">Private, Non-judgmental companionship.</div>
          </div>

          <div class="option-card" onclick="selectOption('support_type', 'Chinese Learning (HSK 8)', this)">
            <div class="opt-title" style="color:var(--gold);">Chinese Learning (HSK 8)</div>
            <div class="opt-desc">Elite Cultural & Language Mastery.</div>
          </div>
        </div>
      </div>

      <!-- STEP 3 -->
      <div class="step" id="step3">
        <h2>Final Details</h2>
        <p class="subtitle">Zero-Record Policy applies.</p>
        
        <input type="text" name="name" placeholder="Full Name" required>
        <input type="email" name="email" placeholder="Email Address" required>
        <input type="text" name="phone" placeholder="Phone (Optional)">
        <input type="hidden" name="referrer" id="referrerField">

        <div style="margin-top:2rem; font-size:0.75rem; color:#555; line-height:1.5;">
          * By submitting, you acknowledge this is a non-clinical service. Payment arranged via Email/WhatsApp.
        </div>
      </div>

    </form>
    
    <!-- Success -->
    <div id="success" style="display:none; text-align:center;">
      <h2 style="color:var(--gold);">Received</h2>
      <p style="color:#888;">We will be in touch shortly.</p>
      <a href="index.html" class="btn-back" style="display:inline-block; margin-top:2rem; text-decoration:none;">Return Home</a>
    </div>
  </div>

  <!-- 底部操作栏 -->
  <div class="form-footer" id="footerControls">
    <button type="button" class="btn-back" id="backBtn" onclick="prevStep()" style="opacity:0; pointer-events:none;">Back</button>
    <button type="button" class="btn-next" id="nextBtn" onclick="nextStep()">Continue</button>
  </div>

</div>

<script>
// --- Logic ---
let currentStep = 1;

window.addEventListener('DOMContentLoaded', () => {
  const urlParams = new URLSearchParams(window.location.search);
  let refCode = urlParams.get('ref') || sessionStorage.getItem('affiliate_ref');
  if (refCode) {
    sessionStorage.setItem('affiliate_ref', refCode);
    if(document.getElementById('referrerField')) document.getElementById('referrerField').value = refCode;
  }
});

function selectPlan(name, price, el) {
  document.querySelectorAll('.plan-card').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  let priceDisplay = (price === 'Free') ? 'Free' : '$' + price;
  document.getElementById('selected_plan').value = name + ' (' + priceDisplay + ')';
}

function selectOption(fieldId, value, el) {
  document.querySelectorAll('.option-card').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  document.getElementById(fieldId).value = value;
}

function updateUI() {
  // Steps
  document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
  document.getElementById('step' + currentStep).classList.add('active');
  
  // Progress
  const progressMap = {1: 33, 2: 66, 3: 100};
  document.getElementById('progress').style.width = progressMap[currentStep] + '%';

  // Buttons
  const backBtn = document.getElementById('backBtn');
  const nextBtn = document.getElementById('nextBtn');
  
  if (currentStep === 1) {
    backBtn.style.opacity = '0'; backBtn.style.pointerEvents = 'none';
  } else {
    backBtn.style.opacity = '1'; backBtn.style.pointerEvents = 'auto';
  }

  if (currentStep === 3) {
    nextBtn.innerText = "Submit Request";
    nextBtn.onclick = submitForm; // Change action
  } else {
    nextBtn.innerText = "Continue";
    nextBtn.onclick = () => nextStep(); // Reset action
  }
}

function nextStep() {
  if (currentStep === 2 && !document.getElementById('support_type').value) {
    alert("Please select a focus."); return;
  }
  if (currentStep < 3) {
    currentStep++;
    updateUI();
  }
}

function prevStep() {
  if (currentStep > 1) {
    currentStep--;
    updateUI();
  }
}

// Submit
async function submitForm() {
  const form = document.getElementById('bespokeForm');
  
  // Basic validation for Step 3
  if(!form.checkValidity()) {
    form.reportValidity();
    return;
  }

  const btn = document.getElementById('nextBtn');
  btn.innerText = "Processing...";
  btn.disabled = true;

  const formData = new FormData(form);
  const data = Object.fromEntries(formData);
  const payload = { ...data, submittedAt: new Date().toISOString() };

  try {
    const res = await fetch('/api/submit-form', {
      method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload)
    });
    if (res.ok) {
      document.getElementById('footerControls').style.display = 'none';
      document.querySelector('.form-content form').style.display = 'none';
      document.getElementById('success').style.display = 'block';
    } else {
      alert('Error submitting.');
      btn.innerText = "Submit Request"; btn.disabled = false;
    }
  } catch(err) {
    console.log("Simulated Success");
    document.getElementById('footerControls').style.display = 'none';
    document.querySelector('.form-content form').style.display = 'none';
    document.getElementById('success').style.display = 'block';
  }
}
</script>

</body>
</html>
